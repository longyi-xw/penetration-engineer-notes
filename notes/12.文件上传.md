# WEB-文件上传漏洞

## 文件绕过

### 前端绕过

如果文件上传的类型在前端声明，则可以通过修改js代码或者html元素，或者直接分析文件上传接口发送接口请求

### MIME绕过

如果接口请求限制了MIME类型，则可以通过抓包修改请求头的方式绕过上传类型显示

### 文件头绕过

上传的文件如果检测文件内容，则可以伪造文件内容头从而绕过文件上传

### 解析漏洞

如果限制了所有可直接上传后门脚本的方式，则可以通过上传图片包含后门代码的方式，尝试判断目标服务器环境是否
存在解析漏洞，从而触发图片后门执行。

解析漏洞需要根据目标服务器的运行环境来判断和验证需要使用什么方式上传后门代码。

### ASP解析漏洞

1.如果上传到文件目录包含 `.aspxxx/xxx.jpg` 则可以解析成asp代码执行
2.如果上传到文件名开头以 `.asp;xxx.jpg` 则同样可以解析成asp后门代码执行。

### Apache解析漏洞

1.如果上传到文件后缀以`%oa`可以绕过黑名单验证。

### Nginx解析漏洞

在特定版本中的nginx存在解析漏洞，如果图片后缀为php并且包含后门代码则可以被执行。

### 二次渲染绕过

比对上传文件和上传后文件大小内容是否相同，以此来判断文件是否经过服务器二次渲染，如果存在二次渲染则分析文件
保留后共同区域，将后门代码写入文件的保留区域中，以此来达到后门代码上传到服务器环境

## 文件绕过目的

### 后门

为了上传后门脚本，从而通过连接后门获取目标服务器的操作权限或者获取其重要文件，数据的访问。

注：以上所有绕过逻辑和后门上传后执行都需要服务器环境存在后门代码解析漏洞，否则无效。

`phpStudy 探针 2014`: 可以访问后台管理系统，如果可以将后门上传到服务器中则可以执行后门代码。
